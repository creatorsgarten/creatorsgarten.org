---
import Blank from './blank.astro'

import Announcement from '$components/announcement.astro'
import AuthButton from '$components/authButton.astro'
import DocSearch from '../docsearch/docsearch.astro'
import FooterLogo from './footerLogo.astro'
import { Search } from '@lucide/astro'

import { getFeatureFlags } from '$functions/getFeatureFlags'
import HeaderOgImage from './headerOgImage.astro'

export interface Props {
  class?: string
}

const featureFlags = getFeatureFlags(Astro)
---

<Blank>
  {
    featureFlags.isEnabled('og:image') ? (
      <Fragment>
        <div class="mb-8 flex h-[285px] items-center justify-center">
          <HeaderOgImage />
        </div>
      </Fragment>
    ) : (
      <Fragment>
        <Announcement />

        {/* <nav class="flex flex-col justify-between px-4 pb-8 pt-6 text-xl sm:flex-row lg:px-8">
          <div class="flex w-full justify-between">
            <a href="/" aria-label="back to home" class="flex items-center">
              <HeaderLogo />
            </a>
            <button
              class="ml-auto text-3xl sm:hidden"
              onclick="let m=document.getElementById('nav-menu');m.classList.toggle('block');m.classList.toggle('hidden');"
            >
              ğŸ”
            </button>
          </div>
          <div
            id="nav-menu"
            class="ml-auto hidden w-full items-center pt-6 text-sm font-medium sm:col-span-1 sm:flex sm:w-auto sm:space-x-1 sm:p-0"
          >
            <ul
              class={`mb-2 flex shrink-0 justify-between gap-2 px-3 py-1 text-lg uppercase sm:mb-0 sm:flex sm:space-x-2 md:list-none md:text-base`}
            >
              <li>
                <a href="/wiki/SelfIntroduction">Us</a>
              </li>
              <li>
                <a href="/events">Events</a>
              </li>
              <li>
                <a href="/videos">Videos</a>
              </li>
              <li>
                <a href="/wiki">Wiki</a>
              </li>
            </ul>
            <AuthButton />
          </div>
        </nav> */}
        <nav class="relative bg-white p-2 pt-3">
          <div class="flex justify-between gap-1.5 text-sm font-medium sm:text-[16px]">
            <a href="/" class="group flex items-center gap-1.5">
              <div
                class="flex aspect-square items-center justify-center rounded-md bg-neutral-100 px-2 py-2 transition-colors group-hover:bg-blue-500 group-hover:text-white"
              >
                <img src="/images/icons/solid.svg" class="h-4 w-4 invert-0 transition-all group-hover:invert" alt="Creatorsgarten" />
              </div>
              <div
                class="flex items-center rounded-md bg-neutral-100 px-2 py-1 lg:pt-[0.35rem] :pb-[0.15rem] h-full transition-colors group-hover:bg-blue-500 group-hover:text-white"
              >
                Creatorsgarten
              </div>
            </a>

            <!-- Desktop center menu -->
            <div class="hidden items-center gap-1.5 md:flex">
              <a
                href="/events"
                class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] h-full transition-colors hover:bg-blue-500 hover:text-white"
              >
                <span>Events</span>
              </a>
              <a
                href="/videos"
                class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] h-full transition-colors hover:bg-blue-500 hover:text-white"
              >
                <span>Videos</span>
              </a>
              <a
                href="/wiki/People"
                class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] h-full transition-colors hover:bg-blue-500 hover:text-white"
              >
                <span>People</span>
              </a>
              {/* <a
                href="/wiki/SelfIntroduction"
                class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] h-full transition-colors hover:bg-blue-500 hover:text-white"
              >
                <span>About</span>
              </a> */}
              <a
                href="/wiki"
                class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] h-full transition-colors hover:bg-blue-500 hover:text-white"
              >
                <span>Wiki</span>
              </a>
            </div>

            <!-- Desktop right menu -->
            <div class="hidden items-center gap-1.5 md:flex">
              <button
                class="flex cursor-pointer items-center justify-center rounded-md bg-neutral-100 px-2 h-full transition-colors hover:bg-blue-500 hover:text-white"
                onclick="document.querySelector('.DocSearch-Button')?.click()"
                aria-label="Search"
              >
                <Search size={20} stroke-width={2} />
              </button>
              <AuthButton />
            </div>
            <div class="hidden">
              <DocSearch />
            </div>

            <!-- Mobile hamburger button -->
            <button
              id="nav-menu-button"
              class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] transition-colors hover:bg-blue-500 hover:text-white md:hidden"
              aria-label="Menu"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
            </button>

            <!-- Mobile menu dropdown -->
            <div
              id="nav-mobile-menu"
              class="absolute top-full right-2 z-50 mt-2 hidden w-48 flex-col gap-1.5 rounded-lg bg-white p-2 shadow-lg text-lg border "
            >
              <a
                href="/events"
                class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] transition-colors hover:bg-blue-500 hover:text-white"
              >
                <span>Events</span>
              </a>
              <a
                href="/videos"
                class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] transition-colors hover:bg-blue-500 hover:text-white"
              >
                <span>Videos</span>
              </a>
              <a
                href="/wiki/People"
                class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] transition-colors hover:bg-blue-500 hover:text-white"
              >
                <span>People</span>
              </a>
              {/* <a
                href="/wiki/SelfIntroduction"
                class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] transition-colors hover:bg-blue-500 hover:text-white"
              >
                <span>About</span>
              </a> */}

              <a
                href="/wiki"
                class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] transition-colors hover:bg-blue-500 hover:text-white"
              >
                <span>Wiki</span>
              </a>

              <div class="border-b pb-1 mb-1"></div>

                              <button
                class="flex items-center rounded-md bg-neutral-100 px-2 pt-[0.35rem] pb-[0.15rem] transition-colors hover:bg-blue-500 hover:text-white"
                onclick="document.querySelector('.DocSearch-Button')?.click()"
                aria-label="Search"
              >
                Search
              </button>
              <AuthButton />
            </div>
          </div>
        </nav>
      </Fragment>
    )
  }
  <main {...{ class: ' ' + Astro.props.class }}>
    <slot />
  </main>

  <!-- <footer
    class="mt-16 flex h-40 flex-col-reverse items-start justify-start bg-ck p-4 text-white sm:flex-row sm:items-end sm:justify-between lg:p-8 lg:text-lg"
  >
    <div class="mt-4 sm:mt-0">Crafted by ğŸ‘©â€ğŸ’» ğŸ§‘â€ğŸ¨ ğŸ§™ ğŸ¦¹â€â™€ï¸ & more.</div>
    <FooterLogo />
  </footer> -->

  <footer
    class="mt-12 flex w-full items-end font-medium justify-between border-t border-black bg-black p-4 pt-16 text-white"
  >
    <div class="text-base md:text-lg">Made with ğŸ’— (+ğŸ§‹) by ğŸ‘¨â€ğŸ’» ğŸ‘©â€ğŸ¨ ğŸ§™ ğŸ¦¸</div>
    <FooterLogo />
  </footer>

  <script>
    function initMobileMenu() {
      // Mobile menu toggle
      const menuButton = document.getElementById('nav-menu-button')
      const mobileMenu = document.getElementById('nav-mobile-menu')

      if (!menuButton || !mobileMenu) return

      // Remove any existing listeners by cloning and replacing
      const newMenuButton = menuButton.cloneNode(true) as HTMLElement
      menuButton.parentNode?.replaceChild(newMenuButton, menuButton)

      newMenuButton.addEventListener('click', e => {
        e.stopPropagation()
        mobileMenu.classList.toggle('hidden')
        mobileMenu.classList.toggle('flex')
      })

      // Close menu when clicking outside
      const handleOutsideClick = (e: MouseEvent) => {
        if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
          const target = e.target as HTMLElement
          if (!mobileMenu.contains(target) && target !== newMenuButton) {
            mobileMenu.classList.add('hidden')
            mobileMenu.classList.remove('flex')
          }
        }
      }
      document.addEventListener('click', handleOutsideClick)

      // Close menu when clicking a link inside it
      mobileMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu.classList.add('hidden')
          mobileMenu.classList.remove('flex')
        })
      })
    }

    // Run on initial load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMobileMenu)
    } else {
      initMobileMenu()
    }

    // Run on Astro page transitions
    document.addEventListener('astro:page-load', initMobileMenu)
  </script>
</Blank>
